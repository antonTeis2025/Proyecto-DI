

<!DOCTYPE html>

<html lang="es" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>conexion &#8212; Aplicacion de Gestion (Diseño de Interfaces)</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="../_static/documentation_options.js?v=10b23a5c"></script>
    <script src="../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             accesskey="I">índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Aplicacion de Gestion (Diseño de Interfaces)</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">conexion</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Código fuente para conexion</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyQt6</span><span class="w"> </span><span class="kn">import</span> <span class="n">QtSql</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">globals</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">globals</span><span class="w"> </span><span class="kn">import</span> <span class="n">mboxStyleSheet</span>

<div class="viewcode-block" id="Conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion">[documentos]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Conexion</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para manejar la conexión y operaciones sobre la base de datos SQLite</span>
<span class="sd">    de clientes, productos y facturación mediante PyQt6.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Conexion.db_conexion">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.db_conexion">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">db_conexion</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Establece la conexión con la base de datos SQLite y verifica su validez.</span>

<span class="sd">        :return: True si la conexión es correcta y la base de datos es válida, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ruta_db</span> <span class="o">=</span> <span class="s1">&#39;./data/bbdd.sqlite&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">ruta_db</span><span class="p">):</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;El archivo de la base de datos no existe.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlDatabase</span><span class="o">.</span><span class="n">addDatabase</span><span class="p">(</span><span class="s1">&#39;QSQLITE&#39;</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">setDatabaseName</span><span class="p">(</span><span class="n">ruta_db</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">open</span><span class="p">():</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Base de datos vacía o no válida.&#39;</span><span class="p">,</span>
                                               <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mbox</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">()</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Information&quot;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Icon</span><span class="o">.</span><span class="n">Information</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Conexión Base de Datos realizada&#39;</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setStandardButtons</span><span class="p">(</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">mboxStyleSheet</span><span class="p">)</span>
                <span class="n">mbox</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;No se pudo abrir la base de datos.&#39;</span><span class="p">,</span>
                                           <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">StandardButton</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listProv">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listProv">[documentos]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">listProv</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lista todas las provincias existentes en la base de datos.</span>

<span class="sd">        :return: Lista de nombres de provincias.</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listProv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM provincias;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">listProv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">listProv</span></div>


<div class="viewcode-block" id="Conexion.listMuniProv">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listMuniProv">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listMuniProv</span><span class="p">(</span><span class="n">provincia</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene los municipios correspondientes a una provincia dada.</span>

<span class="sd">        :param provincia: Nombre de la provincia.</span>
<span class="sd">        :type provincia: str</span>
<span class="sd">        :return: Lista de nombres de municipios pertenecientes a la provincia.</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">listMunicipios</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;SELECT * FROM municipios WHERE idprov = (SELECT idprov FROM provincias WHERE provincia = :provincia)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:provincia&quot;</span><span class="p">,</span> <span class="n">provincia</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">listMunicipios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">listMunicipios</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en listMunicipios&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.listCustomers">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listCustomers">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listCustomers</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lista todos los clientes o solo los históricos según el parámetro.</span>

<span class="sd">        :param var: True para listar solo clientes históricos, False para todos.</span>
<span class="sd">        :type var: bool</span>
<span class="sd">        :return: Lista de clientes, cada cliente es una lista de sus campos.</span>
<span class="sd">        :rtype: list[list]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listCustomers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers WHERE historical = :true ORDER BY surname;&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:true&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers ORDER BY surname;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                <span class="n">listCustomers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listCustomers</span></div>


<div class="viewcode-block" id="Conexion.dataOneCustomer">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.dataOneCustomer">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dataOneCustomer</span><span class="p">(</span><span class="n">dato</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene los datos de un cliente a partir de su móvil o DNI/NIE.</span>

<span class="sd">        :param dato: Número de móvil o DNI/NIE del cliente.</span>
<span class="sd">        :type dato: str</span>
<span class="sd">        :return: Lista con los datos del cliente, vacía si no se encuentra.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers WHERE mobile = :dato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dato&quot;</span><span class="p">,</span> <span class="n">dato</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers WHERE dni_nie = :dato&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dato&quot;</span><span class="p">,</span> <span class="n">dato</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                    <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en dataOneCustomer&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.delCli">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.delCli">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delCli</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Marca un cliente como no histórico (eliminación lógica).</span>

<span class="sd">        :param dni: DNI/NIE del cliente.</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE customers SET historical = :false WHERE dni_nie = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:false&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en delCli&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.addCli">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.addCli">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">addCli</span><span class="p">(</span><span class="n">newcli</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Agrega un nuevo cliente a la base de datos.</span>

<span class="sd">        :param newcli: Lista con los datos del cliente en el siguiente orden:</span>
<span class="sd">                       [dni_nie, adddata, surname, name, mail, mobile, address, province, city, invoicetype]</span>
<span class="sd">        :type newcli: list</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO customers (dni_nie, adddata, surname, name, mail, mobile, address, province, city, invoicetype, historical) &quot;</span>
                <span class="s2">&quot;VALUES (:dnicli, :adddata, :surname, :name, :mail, :mobile, :address, :province, :city, :invoicetype, :historical)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dnicli&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:adddata&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:surname&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mail&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mobile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:address&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:province&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:city&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:invoicetype&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newcli</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:historical&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error addCli&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.modifCli">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifCli">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifCli</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">modifCli</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifica los datos de un cliente existente.</span>

<span class="sd">        :param dni: DNI/NIE del cliente a modificar.</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :param modifCli: Lista con los nuevos datos del cliente en el siguiente orden:</span>
<span class="sd">                         [adddata, surname, name, mail, mobile, address, province, city, historical, invoicetype]</span>
<span class="sd">        :type modifCli: list</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE customers SET adddata = :adddata, surname = :surname, name = :name, mail = :mail, &quot;</span>
                <span class="s2">&quot;mobile = :mobile, address = :address, province = :province, city = :city, &quot;</span>
                <span class="s2">&quot;invoicetype = :invoicetype, historical = :historical WHERE dni_nie = :dni&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:adddata&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:surname&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mail&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:mobile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:address&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:province&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:city&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:invoicetype&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:historical&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifCli</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modifyCli&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.addProduct">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.addProduct">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">addProduct</span><span class="p">(</span><span class="n">newProduct</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Agrega un nuevo producto a la base de datos.</span>

<span class="sd">        :param newProduct: Lista con los datos del producto en el siguiente orden:</span>
<span class="sd">                           [name, family, stock, unitPrice]</span>
<span class="sd">        :type newProduct: list</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO products (name, stock, family, unitPrice) VALUES (:name, :stock, :family, :unitPrice)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newProduct</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:stock&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newProduct</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:family&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newProduct</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:unitPrice&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">newProduct</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error addProduct&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.listProducts">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.listProducts">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">listProducts</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lista todos los productos existentes en la base de datos.</span>

<span class="sd">        :return: Lista de productos, cada producto es una lista de sus campos.</span>
<span class="sd">        :rtype: list[list]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
        <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM products;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">products</span></div>


<div class="viewcode-block" id="Conexion.dataOneProduct">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.dataOneProduct">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dataOneProduct</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene los datos de un producto por su nombre.</span>

<span class="sd">        :param name: Nombre del producto.</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :return: Lista con los datos del producto, vacía si no se encuentra.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM products WHERE name = :dato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dato&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en dataOneProduct&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.modifyProduct">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.modifyProduct">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modifyProduct</span><span class="p">(</span><span class="n">modifProduct</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifica los datos de un producto existente.</span>

<span class="sd">        :param modifProduct: Lista con los datos del producto en el siguiente orden:</span>
<span class="sd">                             [name, stock, family, unitPrice]</span>
<span class="sd">        :type modifProduct: list</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE products SET stock = :stock, family = :family, unitPrice = :unitPrice WHERE name = :name&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifProduct</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:stock&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifProduct</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:family&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifProduct</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:unitPrice&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">modifProduct</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error modifyProduct&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.delProduct">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.delProduct">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delProduct</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Elimina un producto de la base de datos.</span>

<span class="sd">        :param name: Nombre del producto.</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM products WHERE name = :dato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dato&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error delProduct&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


    <span class="c1"># Métodos de facturación</span>
<div class="viewcode-block" id="Conexion.buscaCli">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.buscaCli">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">buscaCli</span><span class="p">(</span><span class="n">dni</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprueba si existe un cliente por su DNI/NIE.</span>

<span class="sd">        :param dni: DNI/NIE del cliente.</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :return: True si el cliente existe, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers WHERE dni_nie = :dato&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dato&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en buscaCli&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.insertInvoice">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.insertInvoice">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">insertInvoice</span><span class="p">(</span><span class="n">dni</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserta una nueva factura para un cliente.</span>

<span class="sd">        :param dni: DNI/NIE del cliente.</span>
<span class="sd">        :type dni: str</span>
<span class="sd">        :param date: Fecha de la factura.</span>
<span class="sd">        :type date: str</span>
<span class="sd">        :return: True si la operación fue exitosa, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO invoices (dni_nie, date) VALUES (:dni, :date)&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:dni&quot;</span><span class="p">,</span> <span class="n">dni</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:date&quot;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en insertInvoice&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Conexion.allInvoice">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.allInvoice">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">allInvoice</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene todas las facturas de la base de datos.</span>

<span class="sd">        :return: Lista de facturas, cada factura es una lista de sus campos.</span>
<span class="sd">        :rtype: list[list]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM invoices ORDER BY idFac DESC;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">records</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en allInvoice&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.selectProduct">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.selectProduct">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">selectProduct</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene un producto por su código.</span>

<span class="sd">        :param item: Código del producto.</span>
<span class="sd">        :type item: str</span>
<span class="sd">        :return: Lista con los datos del producto, vacía si no se encuentra.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM products WHERE code = :code&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:code&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()):</span>
                        <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">records</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error selectProduct&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.saveSales">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.saveSales">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">saveSales</span><span class="p">(</span><span class="n">sales</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Guarda las ventas de una factura en la base de datos.</span>

<span class="sd">        :param sales: Lista de ventas, cada venta contiene</span>
<span class="sd">                      [idFac, idProduct, productName, productPrice, amount, totalPrice]</span>
<span class="sd">        :type sales: list[list]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sale</span> <span class="ow">in</span> <span class="n">sales</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
                <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO sales (idFac, idProduct, productName, productPrice, amount, totalPrice) &quot;</span>
                    <span class="s2">&quot;VALUES (:idFac, :idProduct, :productName, :productPrice, :amount, :totalPrice)&quot;</span><span class="p">)</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idFac&quot;</span><span class="p">,</span> <span class="n">sale</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idProduct&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sale</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:productName&quot;</span><span class="p">,</span> <span class="n">sale</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:productPrice&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sale</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;€&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:amount&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sale</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:totalPrice&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">sale</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;€&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)))</span>
                <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en saveSales&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span></div>


<div class="viewcode-block" id="Conexion.loadSalesByFac">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.loadSalesByFac">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loadSalesByFac</span><span class="p">(</span><span class="n">idFac</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Carga las ventas asociadas a una factura.</span>

<span class="sd">        :param idFac: ID de la factura.</span>
<span class="sd">        :type idFac: int</span>
<span class="sd">        :return: Lista de ventas, cada venta es una lista de sus campos.</span>
<span class="sd">        :rtype: list[list]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM sales WHERE idFac = :idFac;&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idFac&quot;</span><span class="p">,</span> <span class="n">idFac</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">while</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">():</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">record</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">())]</span>
                    <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">records</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en loadSalesByFac&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span></div>


<div class="viewcode-block" id="Conexion.existeFacturaSales">
<a class="viewcode-back" href="../src/conexion.html#conexion.Conexion.existeFacturaSales">[documentos]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">existeFacturaSales</span><span class="p">(</span><span class="n">idFac</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Comprueba si existen ventas asociadas a una factura.</span>

<span class="sd">        :param idFac: ID de la factura.</span>
<span class="sd">        :type idFac: int</span>
<span class="sd">        :return: True si existen ventas para la factura, False en caso contrario.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">QtSql</span><span class="o">.</span><span class="n">QSqlQuery</span><span class="p">()</span>
            <span class="n">query</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM sales WHERE idFac = :idFac&quot;</span><span class="p">)</span>
            <span class="n">query</span><span class="o">.</span><span class="n">bindValue</span><span class="p">(</span><span class="s2">&quot;:idFac&quot;</span><span class="p">,</span> <span class="n">idFac</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">exec</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">query</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error en existeFacturaSales&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Búsqueda rápida</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Ir a" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navegación</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Índice General"
             >índice</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Índice de Módulos Python"
             >módulos</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Aplicacion de Gestion (Diseño de Interfaces)</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Código de módulo</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">conexion</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Miguel Rodríguez Quintás.
      Creado usando <a href="https://www.sphinx-doc.org/">Sphinx</a> 9.0.4.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>